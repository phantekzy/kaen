/* Import section */
import { useState } from "react"
// Keeping the original import as requested:
import { Link } from "react-router"
import { Menu, X, Github } from "lucide-react"
import { useAuth } from "../context/AuthContext"

/* Navigation bar links */
const navLinks = [
    { name: "Home", link: "/" },
    { name: "Create Post", link: "/create" },
    { name: "Forums", link: "/forums" },
    { name: "Create Forum", link: "/forum/create" },
]

/* Navigation bar */
export const Navbar = () => {
    /* use state section */
    const [menuOpen, setMenuOpen] = useState(false)
    /* Toggle mobile menu */
    const toggleMenu = () => {
        setMenuOpen((prev) => !prev)
    }
    /* Authentification */
    const { signInWithGitHub, signOut, user } = useAuth()
    const displayName = user?.user_metadata.user_name || user?.email

    // Handle closing menu on navigation for mobile
    const handleLinkClick = () => {
        if (menuOpen) {
            toggleMenu()
        }
    }

    /* Deep Dark Theme Constants (Blue Accent) */
    const BG_DEEP_DARK = "bg-gray-950/95"; // Nearly black
    const ACCENT_COLOR_TEXT = "text-blue-400";
    const ACCENT_COLOR_BG = "bg-blue-600";
    const ACCENT_COLOR_HOVER_BG = "hover:bg-blue-700";
    const BORDER_COLOR = "border-blue-500/30";
    const HOVER_DARK = "hover:bg-gray-800";

    // Icon used for brand (reverting to Code for dev theme, or can be changed easily)
    const BrandIcon = Code;

    return (
        <nav className={`fixed top-0 w-full z-40 ${BG_DEEP_DARK} backdrop-blur-md border-b ${BORDER_COLOR} shadow-2xl shadow-black/80`}>
            <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                <div className="flex justify-between items-center h-16">
                    {/* Logo & Brand Name */}
                    <Link
                        className="flex flex-row items-center justify-center font-sans text-2xl font-bold text-white tracking-wide"
                        to={"/"}
                        onClick={handleLinkClick}
                    >
                        <BrandIcon size={28} className={`mr-2 ${ACCENT_COLOR_TEXT}`} />
                        <span className="pt-0.5">
                            K<span className={ACCENT_COLOR_TEXT}>ae</span>n
                        </span>
                    </Link>

                    {/* Desktop navigation bar */}
                    <div className="hidden md:flex items-center space-x-8">
                        {/* Navigation Links */}
                        <div className="flex space-x-2">
                            {navLinks.map(({ name, link }) => (
                                <Link
                                    key={name}
                                    to={link}
                                    className={`text-gray-300 text-sm font-medium ${HOVER_DARK} hover:${ACCENT_COLOR_TEXT} transition-all duration-300 px-3 py-1.5 rounded-lg relative group`}
                                >
                                    {name}
                                    {/* Accent line hover effect */}
                                    <span className="absolute left-0 bottom-0 h-[2px] w-0 bg-blue-500 transition-all duration-300 group-hover:w-full"></span>
                                </Link>
                            ))}
                        </div>

                        {/* Desktop Auth Section */}
                        {user
                            ? (
                                <div className="flex items-center space-x-3 ml-4">
                                    {/* Profile picture */}
                                    {user.user_metadata.avatar_url && (
                                        <img
                                            src={user.user_metadata.avatar_url}
                                            alt="Profile picture"
                                            className={`w-8 h-8 rounded-full object-cover border-2 border-blue-500`}
                                        />
                                    )}
                                    {/* Username */}
                                    <span className={`text-sm font-semibold ${ACCENT_COLOR_TEXT} hidden lg:inline`}>
                                        {displayName}
                                    </span>
                                    <button
                                        className="bg-red-600 hover:bg-red-700 text-white text-sm px-3 py-1.5 rounded-lg font-medium transition duration-200 shadow-lg"
                                        onClick={signOut}>
                                        Sign out
                                    </button>
                                </div>
                            )
                            : (
                                <button
                                    className={`flex items-center ${ACCENT_COLOR_BG} ${ACCENT_COLOR_HOVER_BG} text-white text-sm px-4 py-1.5 rounded-lg font-medium transition duration-200 shadow-lg`}
                                    onClick={signInWithGitHub}>
                                    <Github size={18} className="mr-2" />
                                    Sign in with GitHub
                                </button>
                            )
                        }
                    </div>

                    {/* Mobile menu button (always visible on mobile) */}
                    <div className="md:hidden flex items-center">
                        {/* Mobile Auth button (just the sign-in button if not logged in) */}
                        {!user && (
                            <button
                                className={`${ACCENT_COLOR_BG} ${ACCENT_COLOR_HOVER_BG} text-white text-sm px-3 py-1.5 rounded-lg font-medium transition duration-200 mr-4`}
                                onClick={signInWithGitHub}>
                                <Github size={18} />
                            </button>
                        )}
                        <button
                            className={`text-gray-300 focus:outline-none hover:${ACCENT_COLOR_TEXT} transition-colors p-1 rounded-md`}
                            onClick={toggleMenu}
                            aria-expanded={menuOpen}
                            aria-controls="mobile-menu"
                        >
                            {menuOpen ? <X size={24} /> : <Menu size={24} />}
                        </button>
                    </div>
                </div>
            </div>

            {/* Mobile navigation bar - Animated slide down/up */}
            <div
                id="mobile-menu"
                className={`md:hidden overflow-hidden transition-all duration-300 ease-in-out ${menuOpen ? `max-h-screen border-t ${BORDER_COLOR}` : 'max-h-0'
                    } absolute w-full ${BG_DEEP_DARK} backdrop-blur-lg`}
            >
                <div className="px-2 pt-2 pb-3 space-y-1 sm:px-3">
                    {/* Navigation Links */}
                    {navLinks.map(({ name, link }) => (
                        <Link
                            key={name}
                            to={link}
                            onClick={handleLinkClick}
                            className={`block px-3 py-2 rounded-md text-base font-medium text-gray-300 hover:${ACCENT_COLOR_TEXT} ${HOVER_DARK} transition-colors`}
                        >
                            {name}
                        </Link>
                    ))}

                    {/* Mobile Auth Section */}
                    {user && (
                        <div className="pt-2 border-t border-gray-700 mt-2">
                            <div className="flex items-center px-3 py-2 space-x-3">
                                {user.user_metadata.avatar_url && (
                                    <img
                                        src={user.user_metadata.avatar_url}
                                        alt="Profile picture"
                                        className={`w-8 h-8 rounded-full object-cover border-2 border-blue-500`}
                                    />
                                )}
                                <span className={`text-sm font-semibold ${ACCENT_COLOR_TEXT}`}>
                                    {displayName}
                                </span>
                            </div>
                            <button
                                className="w-full text-center mt-2 bg-red-600 hover:bg-red-700 text-white text-base px-3 py-2 rounded-md font-medium transition duration-200"
                                onClick={signOut}>
                                Sign out
                            </button>
                        </div>
                    )}
                </div>
            </div>
        </nav>
    )
}
